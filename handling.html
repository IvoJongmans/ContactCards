<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="">
    <link href="https://fonts.googleapis.com/css?family=Roboto:700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>Document</title>
    <script>
    $(document).ready(function(){  
        
        $.getJSON("http://localhost/MariaDB-with-PHP---PDO-Version/handling.php?formmethod=GET&id=", function(data){
         console.log(data);
        
        
        $.each(data, function(index,value){            
            $(".flexcontainer").append("<div class='index" + value.id + "'>" + "Voornaam: " + value.name + "<br/>Achternaam: " + value.lastname + "<br/>E-mail: " + value.email + "<br/> ID: " + 
            value.id + "<br/><button id='" + value.id + "'>DELETE</button></div>");
             });
        });  

        
        $(document).on('click','button',function(){
            let btnid = this.id;
            if(btnid == "create") {
                console.log("CREATE!");
                let createurl = "http://localhost/MariaDB-with-PHP---PDO-Version/handling.php?formmethod=CREATE";                
                $.ajax({
                type: "GET",
                url: createurl, 
                async: true, 
                success: function(data){
                    console.log(data);
                    $.each(data, function(index,value){            
                    $(".flexcontainer").append("<div class='index" + value.id +
                     "'><input id='inputname" + value.id + "'" + "type='text' name='naam' placeholder='Update naam' required><br/><input id='inputlastname" + value.id + "'" + "type='text' name='achternaam' placeholder='Update achternaam'><br/><input id='inputemail" + value.id + "'" + " type='text' name='email' placeholder='Update e-mailadres'><input type='hidden' name='id' value='" + value.id + "'>" 
                     + "<br/> <span>ID: " + 
                    value.id + "</span><br/><button id='" + value.id + "' class='save'><img class='saveicon' src='saveicon.png' alt='#'><br/><button class='delete'  id='" + value.id + "'><img src='deleteicon.png' alt='#'></button></div>");
                
             });
            },
                error: function(r, e){
                    console.log("error" + e);   
                }   
            });
            }
            else if((btnid == this.id)&&(this.className == "save")){
                console.log("test");         
                let indexid = this.id;
                console.log(indexid);
                let naam = $("#inputname" + indexid).val();
                let achternaam =  $("#inputlastname" + indexid).val();
                let email =  $("#inputemail" + indexid).val();
                let updateurl = "http://localhost/MariaDB-with-PHP---PDO-Version/handling.php?formmethod=UPDATE&naam=" + naam + "&achternaam=" + achternaam + "&email=" + email + "&id=" + indexid;
                console.log(updateurl);
                $.ajax({
                type: "GET",
                url: updateurl, 
                async: true, 
                success: function(data){
                console.log("update gelukt!");            
                $(".index" + indexid).replaceWith("<div class='index" + indexid + "'>" + "Voornaam: " + naam + "<br/>Achternaam: " + achternaam + "<br/>E-mail: " + email + "<br/> ID: " + 
                indexid + "<br/><button id='" + indexid + "'>DELETE</button></div>");
                $("#succes").html("Item succesvol opgeslagen!");
            }});


                         
            }
            else{
            // let btnid = this.id;
            let delurl = "http://localhost/MariaDB-with-PHP---PDO-Version/handling.php?formmethod=DELETE&id=" + btnid;
            console.log(delurl);
            $.ajax({
                type: "GET",
                url: delurl, 
                async: true, 
                success: function(result){
                if(result == 1){
                    $("#succes").html("Item succesvol verwijderd uit database!");
                    $(".index" + btnid).remove();
                }
                else{
                    $("#error").html("Item niet succesvol verwijderd uit database!");
                }
            }});
        }
        });

        
    });   

    </script>
</head>
<body>
        <button id="create" class="createbutton"><img src="createicon.png" alt="plusicon"></button>

        <div class="flexcontainer">

        </div>

        <!-- <form action="handling.php" method="get">
            <input type="hidden" name="formmethod" value="CREATE">               -->
            <!-- <button id="create">CREATE</button> -->
        <!-- </form> -->
        <form action="handling.php" method="get">
            <input type="hidden" name="formmethod" value="GET">
            <input type="text" name="id">                
            <button type="submit">READ</button>
        </form>
        <form action="handling.php" method="get">
            <input type="hidden" name="formmethod" value="UPDATE">
            <input type="text" name="naam" placeholder="Update naam">                
            <input type="text" name="achternaam" placeholder="Update achternaam">                
            <input type="text" name="email" placeholder="Update e-mailadres">                
            <input type="text" name="id" placeholder="ID om te updaten">                
            <button type="submit">UPDATE</button>
        </form>
        <form action="handling.php" method="get">
            <input type="hidden" name="formmethod" value="DELETE">  
            <input type="text" name="id" placeholder="ID om te verwijderen">         
            <button type="submit">DELETE</button>
        </form>

        <div id="error">
            
        </div>
        <div id="succes">
            
        </div>
   
    
</body>
</html>

